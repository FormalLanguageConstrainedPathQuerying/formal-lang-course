# Описание языка

Описание синтаксиса
```ebnf
prog : (statement ';')* ;                               Программа

statement : bind | print | assign ;                     Выражение

print : '$' expr ;                                      Вывод

bind : 'let' name '=' expr;                             Связывание

assign : name '=' expr;                                 Переопределение

lambda : name '->' CODE;                                Лямбда

expr : '(' expr ')'                 #bracket            Выражение в скобках
     | expr ':=' sa_state expr      #set                Установка начальных/конечных вершин
     | expr '+=' sa_state expr      #add                Добавление начальных/конечных вершин
     | expr '??' get_state          #get                Получение начальных, конечных, достижимых и т.д. вершин
     | lambda '-->' expr            #map                Преобразование всех элементов функцией
     | lambda '?->' expr            #filter             Фильтрация элементов
     | '#' PATH                     #load               Загрузка графа
     | expr '++' expr               #concat             Конкатенация графов/списков/множеств
     | expr '&' expr                #intersect          Пересечение графов/списков/множеств
     | expr '|' expr                #union              Сумма графов/списков/множеств
     | expr '*'                     #kleene             Звезда клини для графа
     | expr '==' expr               #equals             Равенство графов/списков/множеств
     | expr '!=' expr               #unequals           Неравенство графов/списков/множеств
     | '<' str '>'                  #construct          Конструирование графа от одной строки
     | name                         #nameAssign         Присваивание переменной по имени
     | int                          #intAssign          Присваивание переменной по целому числу
     | STRING                       #stringAssign       Присваивание переменной по строке
     | '[]'                         #emptyList          Конструктор пустого списка
     | '[' expr (',' expr)* ']'     #list               Конструктор списка
     | ']' '['                      #emptySet           Конструктор пустого множества
     | ']' expr (',' expr)* '['     #bigSet             Конструктор множества
     ;

name : LETTER (LETTER | DIGIT)* ;                       Имя начинается с буквы

str: (LETTER | DIGIT)+ ;                                Строка

int: DIGIT + ;                                          Целое число

sa_state : 'start' | 'final' ;                          

get_state : sa_state | 'reachable' | 'nodes' | 'edges' | 'labels' ;

CODE : '{' .*? '}' ;
PATH : 'P\'' (.)+? '\'' ;
STRING : '\'' [a-zA-Z0-9] '\'' ;
DIGIT : [0-9] ;
LETTER : [A-Za-z] ;

WS : [ \t\r\n]+ -> skip;
```

### Примеры кода:
1. Загружает граф и выводит его достижимые вершины

        let a = # P'vk.ru/graph';
        $ a ?? reachable;

2. Map и Filter

        $ x -> {x * 2} --> (x -> {x % 2 == 0} ?-> ]1, 2, 3, 4, 5[);

3. Конструирование графов и операции с ними

        let a = <a>; 
        let b = <b>;
        let c = a ++ b;
        c = c *;
        a = a & c
        $ a != b 

### Система типов:
В моём языке есть такие типы:
1. Bool (не используется в синтаксисе, но нужен для вывода ==, !=)
2. String
3. Int
4. List
5. Set
6. Graph

Graph хранится как EpsilonNFA. Вершины, рёбра и метки - это множества.

Операции union, intersect и concat определены для графов, множеств и списков.

При нарушении условий типизации будет выведено сообщение об ошибке, например DifferentTypesEx.

### Ввод и вывод
Ввод новых графов производится с помощью команды # (загрузка), при
этом производится загрузка соответствующего графа из **cfpq_data**.
Вывод графов происходит в формате pydot.
Остальные типы выводятся, как хочет Python.

### Лямбды
Для итерируемых объектов (списков, множеств, т.д.) определены
операции map и filter.
Лямбды могут манипулировать другими переменными.